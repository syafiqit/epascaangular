<div class="row justify-content-end">
  <div class="col-lg-2 pr-0">
    <select class="form-control" [(ngModel)]="filterYear" (change)="getPeruntukanDiambil()">
      <option selected disabled [value]="undefined">Sila Pilih</option>
      <option *ngFor="let year of arrayYear">{{year}}</option>
    </select>
  </div>

  <div class="col-lg-2 pl-0 pull-right">
    <button
      (click)="peruntukanDiambilModal(kelulusan.id, kelulusan.id_tabung, kelulusan.baki_jumlah_siling)"
      class="btn btn-primary pull-right">
      <i class="fa fa-plus mr-2"></i>
      <b>Tambah</b>
    </button>
  </div>
</div>

<div class="row mt-3">
  <div class="col-lg-12">
    <div class="primeng-datatable-container">
      <p-table
        #dataTable
        styleClass="p-datatable-striped"
        [resizableColumns]="true"
        (onLazyLoad)="getPeruntukanDiambil($event)"
        [value]="primengTableHelper.records"
        rows="{{primengTableHelper.defaultRecordsCountPerPage}}"
        [paginator]="false"
        [lazy]="true"
        [loading]="primengTableHelper.isLoading"
        [scrollable]="true"
        ScrollWidth="100%"
        [responsive]="primengTableHelper.isResponsive"
        [resizableColumns]="primengTableHelper.resizableColumns"
      >
        <ng-template pTemplate="header">
          <tr>
            <th style="width: 130px" pSortableColumn="tarikh_cipta">
              Tarikh
              <p-sortIcon field="tarikh_cipta"></p-sortIcon>
            </th>
            <th style="width: 150px" pSortableColumn="baki_jumlah_siling_semasa">
              Peruntukan Semasa
              <p-sortIcon field="baki_jumlah_siling_semasa"></p-sortIcon>
            </th>
            <th style="width: 150px" pSortableColumn="jumlah">
              Peruntukan Diambil
              <p-sortIcon field="jumlah"></p-sortIcon>
            </th>
            <th style="width: 150px" pSortableColumn="baki_jumlah_siling_baharu">
              Peruntukan Baru
              <p-sortIcon field="baki_jumlah_siling_baharu"></p-sortIcon>
            </th>
            <th *ngIf="_appSession.isGranted('Halaman.Tabung.Kelulusan.Edit') || _appSession.isGranted('Halaman.Tabung.Kelulusan.Hapus')" style="width:100px;">Tindakan</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-record="$implicit">
          <tr>
            <td style="width: 130px">
              <span class="p-column-title">Tarikh</span>
              {{record.tarikh_cipta | date:'dd-MM-yyyy'}}
            </td>
            <td style="width: 150px">
              <span class="p-column-title">Peruntukan Semasa</span>
              RM {{record.baki_jumlah_siling_semasa | number: '1.2-2'}}
            </td>
            <td style="width: 150px">
              <span class="p-column-title">Peruntukan Diambil</span>
              RM {{record.jumlah | number: '1.2-2'}}
            </td>
            <td style="width: 150px">
              <span class="p-column-title">Peruntukan Baru</span>
              RM {{record.baki_jumlah_siling_baharu | number: '1.2-2'}}
            </td>
            <td style="width: 100px; text-align: center;" *ngIf="_appSession.isGranted('Halaman.Tabung.Kelulusan.Edit') || _appSession.isGranted('Halaman.Tabung.Kelulusan.Hapus')">
              <div ngbDropdown class="btn-group" role="group" container="body">
                <button
                  type="button"
                  class="btn btn-primary btn-primeng dropdown-toggle"
                  id="action"
                  ngbDropdownToggle
                >
                  <i class="fa fa-cog"></i>
                  <span class="caret"></span>
                  Tindakan
                </button>
                <div ngbDropdownMenu aria-labelledby="action">
                  <button
                    class="dropdown-item"
                    (click)="editPeruntukanDiambil(record.id, kelulusan.id, kelulusan.id_tabung, kelulusan.baki_jumlah_siling)"
                    *ngIf="_appSession.isGranted('Halaman.Tabung.Kelulusan.Edit')"
                  >
                    Lihat
                  </button>
                </div>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
      <div class="primeng-no-data" *ngIf="primengTableHelper.totalRecordsCount == 0">Tiada Data</div>
      <div class="primeng-paging-container justify-content-between">
        <p-paginator
          [rows]="primengTableHelper.defaultRecordsCountPerPage"
          #paginator
          (onPageChange)="getPeruntukanDiambil($event)"
          [totalRecords]="primengTableHelper.totalRecordsCount"
          [rowsPerPageOptions]="primengTableHelper.predefinedRecordsCountPerPage"
        ></p-paginator>
        <span class="total-records-count">Jumlah: {{ primengTableHelper.totalRecordsCount}}</span>
      </div>
    </div>
  </div>
</div>
